!function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function s(e,t){return new RegExp(t,"i").test(e)}r.r(t);var n={allFriends:{},loginVK:(e,t)=>(VK.init({apiId:e}),new Promise((e,r)=>{VK.Auth.login(t=>{t.session?e():r(new Error("Ошибка при авторизации"))},t)})),callAPI:(e,t)=>(t.v=t.v||"5.92",new Promise((r,s)=>{VK.api(e,t,e=>{e.error?s(e.error):r(e.response)})})),loadFriendsFromLocalStorage(){return this.allFriends=localStorage.friends?JSON.parse(localStorage.friends):{},this.allFriends},saveFriendsToLocalStorage(){localStorage.friends=JSON.stringify(this.allFriends)},async addFriendsFromVK(){try{await this.loginVK(6762696,2);const e=await this.callAPI("friends.get",{fields:"photo_50"});for(const t of e.items)this.allFriends.hasOwnProperty(t.id)?(this.allFriends[t.id].firstName=t.first_name,this.allFriends[t.id].lastName=t.last_name,this.allFriends[t.id].photo=t.photo_50):this.allFriends[t.id]={firstName:t.first_name,lastName:t.last_name,photo:t.photo_50,selected:!1}}catch(e){console.error(e)}},getAllFriendsForHB(){let e=[];for(let t in this.allFriends)this.allFriends.hasOwnProperty(t)&&e.push({id:t,firstName:this.allFriends[t].firstName,lastName:this.allFriends[t].lastName,photo:this.allFriends[t].photo,selected:this.allFriends[t].selected});return{items:e}},getUnselectedFriends(e){return{items:this.getAllFriendsForHB().items.filter(t=>{let r=!t.selected;return""!==e&&(r=r&&s(`${t.firstName} ${t.lastName}`,e)),r})}},getSelectedFriends(e){return{items:this.getAllFriendsForHB().items.filter(t=>{let r=t.selected;return""!==e&&(r=r&&s(`${t.firstName} ${t.lastName}`,e)),r})}},toggleFriendStatus(e){this.allFriends[e].selected=!this.allFriends[e].selected}},i={selectedFilter:document.querySelector("#selected-filter"),unselectedFilter:document.querySelector("#unselected-filter"),selectedContainer:document.querySelector("#selected-container"),selectedList:document.querySelector("#selected-list"),unselectedList:document.querySelector("#unselected-list"),saveButton:document.querySelector("#save"),closeButton:document.querySelector("#close"),templateElement:document.querySelector("#friend-template")},l={render:(e,t)=>Handlebars.compile(e.textContent)(t),displayUnselectedFriends(){const e=n.getUnselectedFriends(i.unselectedFilter.value.trim());i.unselectedList.innerHTML=this.render(i.templateElement,e)},displaySelectedFriends(){const e=n.getSelectedFriends(i.selectedFilter.value.trim());i.selectedList.innerHTML=this.render(i.templateElement,e)},displayFriends(){this.displayUnselectedFriends(),this.displaySelectedFriends()}},d={addDrugAndDropListeners(){i.unselectedList.addEventListener("dragstart",e=>{e.dataTransfer.setData("id",e.target.dataset.friend_id)}),i.selectedContainer.addEventListener("dragover",e=>{e.preventDefault()}),i.selectedContainer.addEventListener("drop",e=>{const t=e.dataTransfer.getData("id");n.toggleFriendStatus(t),l.displayFriends()})},toggleStatusHandler(e){if("IMG"===e.target.tagName){const t=e.target.dataset.friend_id;n.toggleFriendStatus(t),l.displayFriends()}},addListeners(){this.addDrugAndDropListeners(),i.unselectedList.addEventListener("click",this.toggleStatusHandler),i.selectedList.addEventListener("click",this.toggleStatusHandler),i.unselectedFilter.addEventListener("keyup",()=>l.displayUnselectedFriends()),i.selectedFilter.addEventListener("keyup",()=>l.displaySelectedFriends()),i.saveButton.addEventListener("click",()=>{n.saveFriendsToLocalStorage()}),i.closeButton.addEventListener("click",()=>window.close())}};n.loadFriendsFromLocalStorage(),(async()=>{await n.addFriendsFromVK(),l.displayFriends(),d.addListeners()})()}]);